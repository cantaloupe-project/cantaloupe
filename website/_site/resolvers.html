<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Extensible image server in Java
">

  <link rel="stylesheet" href="/cantaloupe/css/base.css">

  <title>Cantaloupe</title>
</head>


  <body>

    <div class="container-fluid">

      <div class="clearfix">
        <header>
  <a href="/cantaloupe/">
    <img src="images/cantaloupe.jpg" width="154" height="81">
  </a>
  <h1>
    <a href="/cantaloupe/">Cantaloupe</a>
    <br>
    <small>Extensible IIIF Image API 2.0 image server in Java</small>
  </h1>
</header>

      </div>

      <div class="row">
        <div class="col-sm-3">
          <nav id="toc">
  <ul>
    <li><a href="/cantaloupe/">Home</a>
      <ul>
        <li><a href="/cantaloupe/#About">About</a></li>
        <li><a href="/cantaloupe/#Features">Features</a></li>
        <li><a href="/cantaloupe/#Download">Download</a></li>
      </ul>
    </li>
    <li>
      <a href="getting-started.html">Getting Started</a>
      <ul>
        <li><a href="getting-started.html#Requirements">Requirements</a></li>
        <li><a href="getting-started.html#Configuration">Configuration</a></li>
        <li><a href="getting-started.html#Running">Running</a></li>
        <li><a href="getting-started.html#Upgrading">Upgrading</a></li>
        <li><a href="getting-started.html#Considerations">Considerations</a></li>
      </ul>
    </li>
    <li>
      <a href="resolvers.html">Resolvers</a>
      <ul>
        <li><a href="resolvers.html#FilesystemResolver">Filesystem</a></li>
        <li><a href="resolvers.html#HttpResolver">HTTP</a></li>
        <li><a href="resolvers.html#JdbcResolver">JDBC</a></li>
      </ul>
    </li>
    <li>
      <a href="processors.html">Processors</a>
      <ul>
        <li><a href="processors.html#Java2dProcessor">Java 2D</a></li>
        <li><a href="processors.html#GraphicsMagickProcessor">GraphicsMagick</a></li>
        <li><a href="processors.html#ImageMagickProcessor">ImageMagick</a></li>
        <li><a href="processors.html#KakaduProcessor">Kakadu</a></li>
        <li><a href="processors.html#JaiProcessor">JAI</a></li>
      </ul>
    </li>
    <li>
      <a href="caches.html">Caches</a>
      <ul>
        <li><a href="caches.html#FilesystemCache">Filesystem</a></li>
      </ul>
    </li>
    <li><a href="access-control.html">Access Control</a></li>
    <li><a href="client-caching.html">Client-Side Caching</a></li>
    <li>
      <a href="logging.html">Logging</a>
      <ul>
        <li><a href="logging.html#Application%20Log">Application Log</a></li>
        <li><a href="logging.html#Access%20Log">Access Log</a></li>
      </ul>
    </li>
    <li>
      <a href="source-formats.html">Source Formats</a>
      <ul>
        <li><a href="source-formats.html#JPEG">JPEG</a></li>
        <li><a href="source-formats.html#JPEG2000">JPEG2000</a></li>
        <li><a href="source-formats.html#TIFF">TIFF</a></li>
      </ul>
    </li>
    <li>
      <a href="developers.html">Developer's Guide</a>
      <ul>
        <li><a href="developers.html#Resolvers">Custom Resolvers</a></li>
        <li><a href="developers.html#Processors">Custom Processors</a></li>
        <li><a href="developers.html#Caches">Custom Caches</a></li>
        <li><a href="/cantaloupe/javadoc/">Javadoc</a></li>
        <li><a href="developers.html#Contributing">Contributing</a></li>
      </ul>
    </li>
    <li><a href="changelog.html">Change Log</a>
  </ul>
</nav>

        </div> <!-- .col-sm-3 -->

        <div class="col-sm-9">
          <h2>Resolvers</h2>

<p>Resolvers locate a source image based on the identifier in an IIIF URL. In Java-speak, they take in an identifier and return an InputStream and/or File object from which the corresponding image can be read by a <a href="processors.html">processor</a>.</p>

<h3 id="FilesystemResolver">FilesystemResolver</h3>

<p>FilesystemResolver maps an identifier from an IIIF URL to a filesystem path, for retrieving images on a local or attached filesystem.</p>

<p>For images with extensions that are missing or unrecognized, this resolver will check the "magic number" to determine type, which will add some overhead. It is therefore slightly more efficient to serve images with extensions.</p>

<h4>Prefix and Suffix</h4>

<p>The <code>FilesystemResolver.path_prefix</code> and <code>path_suffix</code> configuration options are optional and intended to make URLs shorter, more stable, and hide sensitive information. For example, with these options set as such:</p>

<pre>FilesystemResolver.path_prefix = /usr/local/images/
FilesystemResolver.path_suffix =</pre>

<p>An identifier of <code>image.jpg</code> in the URL will resolve to
<span class="filename">/usr/local/images/image.jpg</span>.</p>

<p><em>Note: it is dangerous to <strong>not</strong> use <code>path_prefix</code>. The shallower the path, the more of the filesystem that will be exposed.</em></p>

<h4>Path Separator</h4>

<p>The IIIF Image API 2.0 specification mandates that identifiers in URLs be percent-encoded, which changes slashes to <code>%2F</code>. Some reverse-proxy servers automatically decode this into <code>/</code> before passing on the request. This will cause HTTP 404 errors in Cantaloupe.</p>

<p>If you are unable to configure your reverse proxy to stop decoding slashes, the <code>FilesystemResolver.path_separator</code> configuration option will enable you to use an alternate string as a path separator in an identifier. (Be sure to supply the non-percent-encoded string, and then percent-encode it in URLs if it contains any URL-unsafe characters.)</p>

<p>To prevent arbitrary directory traversal, FilesystemResolver will strip out <code>..{path separator}</code> and <code>{path separator}..</code> from identifiers before resolving the path.</p>

<h3 id="HttpResolver">HttpResolver</h3>

<p>HttpResolver maps an identifier from an IIIF URL to an HTTP resource. Image access via HTTP may be slower than via a filesystem, though this varies depending on the relative performance of both, as well as the particular source image format and processor.</p>

<p>It is preferable to use this resolver with source images with recognizable file extensions. For images with an extension that is missing or unrecognizable, it will issue an HTTP HEAD request to the server to check the <code>Content-Type</code> header. If the type cannot be inferred from that, an HTTP 415 response will be returned.</p>

<h4>Prefix and Suffix</h4>

<p>The <code>HttpResolver.url_prefix</code> and <code>url_suffix</code> configuration options are optional and intended to make URLs shorter, more stable, and hide sensitive information. For example, with these options set as such:</p>

<pre>HttpResolver.url_prefix = http://example.org/images/
HttpResolver.url_suffix =</pre>

<p>An identifier of <code>image.jpg</code> in the URL will resolve to
<span class="filename">http://example.org/images/image.jpg</span>.

<h4>Path Separator</h4>

<p>The IIIF Image API 2.0 specification mandates that identifiers in URLs be percent-encoded, which changes slashes to <code>%2F</code>. Some proxy servers automatically decode this into <code>/</code> before passing on the request. This will cause HTTP 404 errors in Cantaloupe.

<p>If you are unable to configure your proxy to stop decoding slashes, the <code>HttpResolver.path_separator</code> configuration option will enable you to use an alternate string as a path separator in an identifier. (Be sure to supply the non-percent-encoded string, and then percent-encode it in URLs if it contains any URL-unsafe characters.)</p>

<h3 id="JdbcResolver">JdbcResolver</h3>

<p>JdbcResolver maps an identifier from an IIIF URL to an RDBMS BLOB field, for retrieving images from a relational database.</p>

<p>Cantaloupe does not include any JDBC drivers, so a driver JAR for the desired database must be obtained separately and saved somewhere on the classpath.</p>

<p>The JDBC connection is initialized by the <code>JdbcResolver.connection_string</code>, <code>JdbcResolver.user</code>, and <code>JdbcResolver.password</code> configuration options. If the user or password are not necessary, they can be left blank. The connection string must use your driver's JDBC syntax:</p>

<p>
  <pre><code>jdbc:postgresql://localhost:5432/my_database
jdbc:mysql://localhost:3306/my_database
jdbc:microsoft:sqlserver://example.org:1433;DatabaseName=MY_DATABASE</code></pre>
</p>

<p>Consult the driver's documentation for details.</p>

<p>Then, the resolver needs to be told:</p>

<ol>
  <li><a href="#JdbcResolverIdentifierFunction">The database value corresponding to a given identifier</a></li>
  <li><a href="#JdbcResolverMediaTypeFunction">The media type corresponding to that value</a></li>
  <li><a href="#JdbcResolverBlobSQL">The SQL command that retrieves the BLOB corresponding to that value</a></li>
</ol>

<h4 id="JdbcResolverIdentifierFunction">Database Identifier Retrieval Function</h4>

<p>This JavaScript function takes in an unencoded identifier and returns the corresponding database value of the identifier. For example, the following will work when the identifiers in the URL map directly to values in the database:</p>

<pre><code>JdbcResolver.function.identifier = function getDatabaseIdentifier(url_identifier) {\
      return url_identifier;\
  }</code></pre>

<p>Otherwise, if the URL identifiers require some transformation first:</p>

<pre><code>JdbcResolver.function.identifier = function getDatabaseIdentifier(url_identifier) {\
        // Assumes that the identifier is stored in the database as\
        // "identifier-something"\
        return url_identifier + "-something";\
    }</code></pre>

<p><em>Note that in properties files, all lines in multi-line strings except the last need to end with a backslash (\).</em></p>

<h4 id="JdbcResolverMediaTypeFunction">Media Type Retrieval Function</h4>

<p>This JavaScript function returns a media (MIME) type corresponding to the value returned by the <code><a href="#JdbcResolverIdentifierFunction">getDatabaseIdentifier()</a></code> function. If the media type is instead stored in the database, this example will return an SQL statement to retrieve it.</p>

<pre><code>JdbcResolver.function.media_type = function getMediaType(identifier) {\
      return "SELECT media_type " +\
          "FROM some_table " +\
          "WHERE some_identifier = ?"\
  }</code></pre>

<p>If the IIIF URL identifier will <strong>always</strong> have a known, valid image extension, like <span class="filename">.jpg</span>, <span class="filename">.tif</span>, etc., the entire <code>JdbcResolver.function.media_type</code> option can be commented out, and Cantaloupe will infer the media type from the extension.</p>

<h4 id="JdbcResolverBlobSQL">BLOB Retrieval SQL</h4>

<p><code>JdbcResolver.lookup_sql</code> is an SQL statement that selects the BLOB corresponding to the value returned by the <code><a href="#JdbcResolverIdentifierFunction">getDatabaseIdentifier()</a></code> function.</p>

<pre><code>JdbcResolver.lookup_sql = SELECT image_blob_column \
    FROM some_table \
    WHERE some_identifier = ?</code></pre>

        </div>
      </div>

      <footer>
</footer>


    </div>

  </body>

</html>
